#!/usr/bin/env node
var server = require('../server')
var webpack = require('webpack')
var conf = require('../webpack.config.dev.js')
var compiler = webpack(conf)

server.app.use(require('webpack-dev-middleware')(compiler, {
  publicPath: conf.output.publicPath,
  stats: {
    colors: true
  }
}))

server.app.use(require('webpack-hot-middleware')(compiler))

server.app.get('*', (req, res) => {
  var ua = req.header('user-agent')
  if (/mobile|nexus\s7/i.test(ua)) {
    res.render('mobile', { title: 'All In', message: 'mobile page' })
  } else {
    res.render('desktop', { title: 'All In', message: 'desktop page' })
  }
})

server.app.set('port', process.env.PORT || server.PORT)

server.app.listen(server.app.get('port'), 'localhost', err => {
  if (err) {
    console.log(err)
    return
  }
  console.log(`Listening at http://localhost:${server.app.get('port')}`)
})
